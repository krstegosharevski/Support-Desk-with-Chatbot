<app-nav></app-nav>
<div class="container pb-4">
    <div class="row mb-3">
        <div class="col-1 ps-4 pt-4 btn-custome-2">
            <button class="btn btn-custome mb-2 px-4" [routerLink]="['/']">Back</button>
        </div>
    </div>
    <div class=" mt-4 row text-center" style="border: 1px solid black;">

        <div class="col p-3" *ngIf="ticket">
            <br>
            <h1>{{ ticket.title }}</h1>
            <!-- <h5>Created by: {{ findTicketUser(ticket.createdById)}}</h5> -->
             <h5>Generated by: {{username?.username}}</h5>
            <br>
            <hr>
            <h5>{{ ticket.message }}</h5>
            <hr>
            <br>
            <div *ngIf="ticket.picturePath">
                <img [src]="'https://localhost:7146' +ticket.picturePath" alt="Ticket Image" style="max-width: 50%; height: auto;">
            </div>
            <br>
            <p>Generated date: {{ ticket.generatedTime | date: 'yyyy-MM-dd' }}</p>

            <br>
            <br>
            <!-- Select за променување на статусот -->
             <div *appHasRole="['Admin']">
                <select class="custom-select" [(ngModel)]="selectedUsername">
                    <option *ngFor="let user of authenticatedUsers" [value]="user.userName">
                      {{ user.name }} {{ user.surname }} ({{ user.userName }})
                    </option>
                </select>
                <button (click)="assignToUser(selectedUsername)" class="btn btn-success ms-2">Save</button>
             </div>
             <div *ngIf="assignedToTicket">
                
                <select class="custom-select" [(ngModel)]="ticket.status" name="status">
                    <option [ngValue]="0">ASSIGNED</option>
                    <option [ngValue]="1">IN PROGRESS</option>
                    <option [ngValue]="2">DONE</option>
                </select>
                <br>
                <br>
                <!-- Textarea за додавање на одговор -->
                <textarea class="p-3 k" [(ngModel)]="ticket.response" name="response" rows="6" cols="90"
                    placeholder="Send response..." required></textarea>
                <br>
                <br>
                <button (click)="saveTicket()" class="btn btn-success">Save</button>
             </div>
            

            <!-- <div class="container">
                <div *ngFor="let comment of comments" class="mt-4" style="background-color: #c8c8c6;">
                    <div class="p-2" >
                        <span><span class="font-weight-bold text-primary">Comment:  </span> <small class="font-weight-bold">{{comment.commentText}}</small></span>
                        <span>{{getRelativeTime(comment.createdAt)}}</span>
                    </div>      
                </div>
            </div> -->

            <div class="comments-container mt-4">
                <h3>Comments section</h3>
                <div *ngFor="let comment of comments" class="comment-card">
                    <div class="comment-header">
                        <span class="comment-text">{{comment.commentText}}</span>
                    </div>
                    <div class="comment-footer">
                        <span class="comment-time">{{getRelativeTime(comment.createdAt)}}</span>
                    </div>
                </div>
                <div class="new-comment-form p-1">
                    <textarea [(ngModel)]="newCommentText" placeholder="Add a new comment..." class="comment-input"></textarea>
                    <button (click)="addComment()" class="btn btn-custome">Comment</button>
                </div>
            </div>
     
        </div>
    </div>
</div>
<div class="mb-4">
<p>Krste XO.</p>
</div>
<app-footer class="mt-4"></app-footer>